\documentclass[11pt]{article}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{float}
\usepackage{subcaption}
\usepackage{fancyhdr}
\usepackage{enumerate}
\usepackage{titlesec}
\usepackage[colorlinks=true,urlcolor=blue]{hyperref}

\titlespacing{\subsubsection}{0pt}{0pt}{0pt}

% No page numbers
%\pagenumbering{gobble}

% INFORMATION SHEET (DO NOT EDIT THIS PART) ---------------------------------------------
\newcommand{\addinformationsheet}{
\clearpage
\thispagestyle{empty}
\begin{center}
\LARGE{\bf \textsf{Information sheet\\CS224W: Machine Learning with Graphs}} \\*[4ex]
\end{center}
\vfill
\textbf{Assignment Submission } Fill in and include this information sheet with each of your assignments.  This page should be the last page of your submission.  Assignments are due at 11:59pm and are always due on a Thursday.  All students (SCPD and non-SCPD) must submit their homework via GradeScope (\url{http://www.gradescope.com}). Students can typeset or scan their homework. Make sure that you answer each (sub-)question on a separate page. That is, one answer per page regardless of the answer length. Students also need to upload their code on Gradescope. Put all the code for a single question into a single file and upload it.  
\\
\\
\textbf{Late Homework Policy } Each student will have a total of {\em two} late periods. {\em Homework are due on Thursdays at 11:59pm PT and one late period expires on the following Monday at 11:59pm PT}.  Only one late period may be used for an assignment.  Any homework received after 11:59pm PT on the Monday following the homework due date will receive no credit.  Once these late periods are exhausted, any assignments turned in late will receive no credit.
\\
\\
\textbf{Honor Code } We strongly encourage students to form study groups. Students may discuss and work on homework problems in groups. However, each student must write down their solutions independently, i.e., each student must understand the solution well enough in order to reconstruct it by him/herself.  Students should clearly mention the names of all the other students who were part of their discussion group. Using code or solutions obtained from the web (GitHub/Google/previous year's solutions etc.) is considered an honor code violation. We check all the submissions for plagiarism. We take the honor code very seriously and expect students to do the same. 
\vfill
}

% MARGINS (DO NOT EDIT) ---------------------------------------------
\oddsidemargin  0.25in \evensidemargin 0.25in \topmargin -0.5in
\headheight 0in \headsep 0.1in
\textwidth  6.5in \textheight 9in
\parskip 1.25ex  \parindent 0ex \footskip 20pt
% ---------------------------------------------------------------------------------

% HEADER (DO NOT EDIT) -----------------------------------------------
\newcommand{\problemnumber}{0}
\newcommand{\myname}{name}
\newfont{\myfont}{cmssbx10 scaled 1000}
\pagestyle{fancy}
\fancyhead{}
\fancyhead[L]{\myfont Question \problemnumber, Homework 1, CS224W}
%\fancyhead[R]{\bssnine \myname}
\newcommand{\newquestion}[1]{
\clearpage % page break and flush floats
\renewcommand{\problemnumber}{#1} % set problem number for header
\phantom{}  % Put something on the page so it shows
}
% ---------------------------------------------------------------------------------


% BEGIN HOMEWORK HERE
\begin{document}

% Question 1.1
\newquestion{1.1}

The log-log degree distribution plot is shown as belows. We can see that
\begin{itemize}
    \item The Small World Network has the most narrow plot comparing to other two networks.
    \item Erdos Renyi Network is more similar with Collaboration Network, which means from the degree distribution perspective, Erdos Renyi models the real networks better.
    \item Compared to random graph networks, the degree distribution of Collaboration Network is more wider.
    \item It has more long-tail nodes which has large degree and small degree.
\end{itemize}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.80\textwidth]{pics/deg_distribution.png}
\end{figure}

% Question 1.2
\newquestion{1.2}

The average clustering coefficient for each network:
\begin{itemize}
    \item Clustering Coefficient for Erdos Renyi Network: 0.001236
    \item Clustering Coefficient for Small World Network: 0.297775
    \item Clustering Coefficient for Collaboration Network: 0.529636
\end{itemize}
We can see that Collaboration Network has the largest average clustering coefficient. \\\\
Since in real life, authors are likely to establish collaboration with those who have collaborated with their collaborators, so the local structure of this subgraph tends to be dense, which results in a larger average clustering coefficient.

% Question 2.1
\newquestion{2.1}
\begin{itemize}
    \item  Feature vector of node 9 is:  $[6, 4, 7]$
    \item Top 5 nodes at most similar to node 9 are:
          (415, 0.9987327913808193) (286, 0.9970704162402443) (288, 0.9970704162402443) (16, 0.9950371902099892) (17, 0.9950371902099892)
\end{itemize}

% Question 2.2
\newquestion{2.2}
\begin{itemize}
    \item Top 5 nodes at most similar to node 9 are:
          (973, 0.9977857208153201) (415, 0.9967754809774014) (296, 0.9922005791814624) (189, 0.9908884045260696) (275, 0.9908884045260696)
    \item There is only one common node which is 415.
    \item Because features generated via aggregation also consider information about the neighbors and the neighbors of neighbors,
          which are more expressive than basic features.
\end{itemize}


% Question 2.3a
\newquestion{2.3a}

Firstly, we draw the histograms as below:
\begin{figure}[H]
    \centering
    \includegraphics[width=0.80\textwidth]{pics/cos_sim_distribution.png}
\end{figure}
From the picture we can observe 4 groups/roles.



% Question 2.3b
\newquestion{2.3b}
Randomly select a point for each group and draw the subgraph of its 2nd neighbors as below:
\begin{figure}[ht]
    \begin{subfigure}{.4\textwidth}
        \centering
        % include first image
        \includegraphics[width=0.8\linewidth]{pics/subgraph_1.png}
    \end{subfigure}
    \begin{subfigure}{.5\textwidth}
        \centering
        % include second image
        \includegraphics[width=.6\linewidth]{pics/subgraph_2.png}
    \end{subfigure}
    \begin{subfigure}{.5\textwidth}
        \centering
        % include first image
        \includegraphics[width=.5\linewidth]{pics/subgraph_3.png}
    \end{subfigure}
    \begin{subfigure}{.5\textwidth}
        \centering
        % include second image
        \includegraphics[width=.5\linewidth]{pics/subgraph_4.png}
    \end{subfigure}
\end{figure}


% Question 3.1
\newquestion{3.1}
According to the formula of modularity, it's easy to get that, for all nodes in a community, e.g., C,
the second part in the formula, i.e., $\frac{d_id_j}{2m}$, is the $(\frac{\Sigma_ik_i}{2m})^2$. \\
So firstly, we can caculate the modularity of C and i before i joins in C.
$$Q_{before} = \frac{\Sigma_{in}}{2m}-(\frac{\Sigma_{tot}}{2m})^2-(\frac{k_i}{2m})^2$$
Then we can caculate the modularity after i joins in C.
$$Q_{after} = \frac{(\Sigma_{in}+k_{i,in})}{2m}-(\frac{\Sigma_{tot}+k_{i}}{2m})^2$$
Finally, we can get the modularity gain.
\begin{equation*}
    \begin{aligned}
        \Delta Q & = Q_{after} - Q_{before}                                              \\
                 & = [\frac{(\Sigma_{in}+k_{i,in})}{2m}-(\frac{\Sigma_{tot}+k_i}{2m})^2]
        -[\frac{\Sigma_{in}}{2m}-(\frac{\Sigma_{tot}}{2m})^2-(\frac{k_i}{2m})^2]
    \end{aligned}
\end{equation*}

% Question 3.2
\newquestion{3.2}
For Graph $H$,
\begin{itemize}
    \item 1
    \item 6
    \item $Q=4*[\frac{12}{56}-(\frac{14}{56})^2]=\frac{17}{28} \approx 0.607$
\end{itemize}
For Graph $J$,
\begin{itemize}
    \item 2
    \item 13
    \item $Q=2*[\frac{26}{56}-(\frac{28}{56})^2]=\frac{3}{7} \approx 0.429$
\end{itemize}


% Question 3.3
\newquestion{3.3}
For Graph $H_{big}$,
\begin{itemize}
    \item 1
    \item 6
    \item $Q=32*[\frac{12}{448}-(\frac{14}{448})^2]= \frac{185}{224} \approx 0.826$
\end{itemize}
For Graph $J_{big}$,
\begin{itemize}
    \item 2
    \item 13
    \item $Q=16*[\frac{26}{448}-(\frac{28}{448})^2]= \frac{97}{112} \approx 0.866$
\end{itemize}

% Question 3.3
\newquestion{3.4}
The definition of modularity focuses on the local structure of a cluster, which may lead to 'suboptimal'
when we need to trade off the number of communities and the modularity of each community. This intuition is consistent with Fortunato and Barthelemy's work \textit{Resolution limit in community detection}.


% Question 4.1
\newquestion{4.1}
\begin{enumerate}[(i)]
    \item From the formula we can see that, for every edge from $j$ to $k$, will contribute $1$ to $L_{j,j}$ and $L_{k,k}$ and $-1$ to $L_{j,k}$ and $L_{k,j}$.
          It follows the way to compute $L$, i.e., $L = D - A$.
    \item $x^TLx = \Sigma_i\Sigma_jx_iL_{i,j}x_j$, so for each edge from $i$ to $j$, will conribute $x_i^2$ and $x_j^2$ and $-(x_i*x_j+x_j*x_i)$ to the final result,
          i.e., $(x_i-x_j)^2$.
    \item We can caculate $x^TLx$ in three parts. For $x_i and x_j$ in the same $S$, $x_i - x_j = 0$. So
          $$x^TLx=\frac{\bar{S}}{S}+\frac{S}{\bar{S}}-2 = cut(S)\frac{(vol(\bar{S})+vol(S))^2}{2vol(\bar{S})vol(S)}=(vol(\bar{S})+vol(S))*NCUT(S)$$
    \item $x^TLe=\Sigma_i \Sigma_j x_i L_{i,j} = \Sigma_i x_i\Sigma_j L_{i,j}=\Sigma_i x_i*0=0$
    \item $x^TDx = \Sigma_i x_i^2*D_{i,i} = vol(S) + vol(\bar{S}) = 2m$
\end{enumerate}

% Question 4.2
\newquestion{4.2}
Firstly, let $z = D^{1/2}x$ and we can rewrite the optimization problem as
\begin{equation*}
    \begin{aligned}
         & minimize_{z\in \mathbb{R}^n}\quad \frac{z^T\widetilde{L}z}{z^Tz} \\
         & s.t.\quad z^TD^{1/2}e=0, z^Tz = 2m
    \end{aligned}
\end{equation*}
As $\widetilde{L}$ is symmetric, so its eigenvectors are orthonormal and we can write $z$ in this form $$z=\Sigma_i w_i v_i$$
where $w_i$s are weights and $v_i$s are $\widetilde{L}$'s eigenvectors.
The optimization objective can also be written as $$\frac{\Sigma_i w_i^2\lambda_i}{2m}$$
where $\lambda_i$s are $\widetilde{L}$'s eigenvalues.
Besides, since $\widetilde{L}*D^{1/2}e = D^{-1/2}LD^{-1/2}*D^{1/2}e=0*e$, so $D^{-1/2}$ is the corresponding eigenvector of $\widetilde{L}$ with a eigenvalue $0$,
which means $w_1$ has to be $0$ according to the subject $z^TD^{1/2}e=0$.
So to minimize the objective, we need to put all weights in the second smallest eigenvalue and thus we have $z=(2m)^{1/2}v$ as the minizer,
where $v$ is the corresponding eigenvector. Finally, we get $$x=(2m)^{1/2}D^{-1/2}v$$

% Question 4.3
\newquestion{4.3}
\begin{equation*}
    \begin{aligned}
        Q(y) & = \frac{1}{2m}(-2cut(S)+vol(S)+vol(\bar{S})-\frac{1}{2m}(vol(S)^2+vol(\bar{S})^2))      \\
             & = \frac{1}{2m}(-2cut(S)+2m-\frac{1}{2m}(vol(S)^2+vol(\bar{S})^2)                        \\
             & = \frac{1}{2m}(-2cut(S)-\frac{1}{2m}[(vol(S)+vol(\bar{S}))^2-(vol(S)^2+vol(\bar{S})^2)] \\
             & = \frac{1}{2m}(-2cut(S)-\frac{1}{m}vol(S)vol(\bar{S}))
    \end{aligned}
\end{equation*}

% Information sheet
% Fill out the information below (this should be the last page of your assignment)
\addinformationsheet
\vfill

{\Large
    \textbf{Your name:} \hrulefill  % Put your name here
    \\
    \\
    \textbf{Email:} \underline{\hspace*{7cm}}  % Put your e-mail here
    \textbf{SUID:} \hrulefill  % Put your student ID here
    \\*[2ex]
}
Discussion Group: \hrulefill   % List your study group here
\\
\vfill\vfill
I acknowledge and accept the Honor Code.\\*[3ex]
\bigskip
\textit{(Signed)}
\hrulefill   % Replace this line with your initials
\vfill






\end{document}